<html>
    <head>
        <title>Generating a planet</title>

        <style> 
            body {margin: 0;}
            canvas {width: 100%; height: 100%;}
        </style>

    </head>

    <body>

        <script src="./js/three.js"></script>
        <script src="./js/simplex-noise.js"></script>
        <script src="./js/OrbitControls.js"></script>

        <style>
            body {
                font-family: Monospace;
                background-color: #666;
                color: #fff;
                margin: 0px;
                overflow: hidden;
            }
            #info {
                position: absolute;
                top: 10px;
                width: 100%;
                text-align: center;
            }
        </style>

        <script>
var scene = new THREE.Scene();
var ratio = window.innerWidth/window.innerHeight;

var camera = new THREE.PerspectiveCamera(70, ratio, 0.1, 1000);
var control = new THREE.OrbitControls(camera);

camera.position.set(0,0,15);
camera.lookAt(0,0,0);
control.update();

var renderer = new THREE.WebGLRenderer();
renderer.setSize(window.innerWidth, window.innerHeight);

document.body.appendChild(renderer.domElement);

var ambientlight = new THREE.AmbientLight(new THREE.Color(1,1,1),.5);
scene.add(ambientlight);

var cameralight = new THREE.PointLight( new THREE.Color(1,1,1), .8 );
cameralight.castShadow=true;
camera.add(cameralight);
scene.add(camera);

//create the material of the cube (basic material)
var terrain_mat = new THREE.MeshStandardMaterial();
//set the color of the cube
terrain_mat.color=  new THREE.Color(.25,.7,.25);
terrain_mat.roughness=.8;
//then set the renderer to wireframe
terrain_mat.wireframe=false;

//create the material of the cube (basic material)
var water_mat = new THREE.MeshStandardMaterial();
//set the color of the cube
water_mat.color=  new THREE.Color(.25,.25,1);
water_mat.roughness=.2;
//then set the renderer to wireframe
water_mat.wireframe=false;

//Create the base terrain
var planet_geometry = new THREE.IcosahedronGeometry(5, 5);
var water_geometry = new THREE.IcosahedronGeometry(5, 2);

//Create the noise, then loop through all the vertices
var simplex = new SimplexNoise();
for (var i = 0; i < planet_geometry.vertices.length; i++)
{
    var vert_pos_x = planet_geometry.vertices[i].x;
    var vert_pos_y = planet_geometry.vertices[i].y;
    var vert_pos_z = planet_geometry.vertices[i].z;
    var dir = new THREE.Vector3(0,0,0);

    //Get the direction of the vertex
    dir.sub(new THREE.Vector3(vert_pos_x, vert_pos_y, vert_pos_z));
    
    var vert_noise = simplex.noise2D(vert_pos_x, vert_pos_y, vert_pos_z);
    planet_geometry.vertices[i].addScaledVector(dir, vert_noise * 0.15);
}

var planet_terrain = new THREE.Mesh(planet_geometry, terrain_mat);
var water = new THREE.Mesh(water_geometry, water_mat);
scene.add(planet_terrain);
scene.add(water);

function animate(){
    requestAnimationFrame(animate);
    
    control.update();
    renderer.render(scene, camera);
}

requestAnimationFrame(animate);

        </script>
    </body>
</html>
